cmake_minimum_required(VERSION 3.21)
project(Parser)
enable_testing()
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED YES)
set(CMAKE_CXX_EXTENSIONS NO)
file(GLOB_RECURSE parser_sources CONFIGURE_DEPENDS "src/*.cpp")
add_library(parser STATIC ${parser_sources})
add_library(parser_stdlib STATIC stdlibs/iscstdlibc++.cpp)
target_include_directories(parser PUBLIC include stdlibs)
if (CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
    add_compile_definitions(__LIBC)
endif()
# test
add_executable(parser_test tests/complete_test.cpp)
target_link_libraries(parser_test parser parser_stdlib)
target_include_directories(parser_test PUBLIC include stdlibs)
target_compile_definitions(parser_test PUBLIC __ROOT_DIR__="${CMAKE_CURRENT_SOURCE_DIR}")
add_test(NAME parser_test COMMAND parser_test)